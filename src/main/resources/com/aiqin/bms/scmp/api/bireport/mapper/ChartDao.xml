<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aiqin.bms.scmp.api.bireport.dao.ChartDao">


    <sql id="select_monthly_sales">
        <where>
            1=1
            <if test="beginCreateTime!=null and beginCreateTime!=''">
                and bms.month between #{beginCreateTime}
            </if>
            <if test="createTime!=null and createTime!=''">
                and #{createTime}
            </if>
            <if test="productSortCode!=null and productSortCode!=''">
                and bms.product_sort_code like concat('%', #{productSortCode}, '%')
            </if>
            <if test="productSortName!=null and productSortName!=''">
                and bms.product_sort_name like concat('%', #{productSortName}, '%')
            </if>
            <if test="orderCode!=null and orderCode!=''">
                and bms.price_channel_code like concat('%', #{orderCode}, '%')
            </if>
            <if test="orderOriginal!=null and orderOriginal!=''">
                and bms.price_channel_name like concat('%', #{orderOriginal}, '%')
            </if>
            <if test="storeTypeCode!=null and storeTypeCode!=''">
                and bms.store_type_code like concat('%', #{storeTypeCode}, '%')
            </if>
            <if test="storeType!=null and storeType!=''">
                and bms.store_type like concat('%', #{storeType}, '%')
            </if>
            <if test="dataTypeCode!=null and dataTypeCode!=''">
                and bms.data_type_code like concat('%', #{dataTypeCode}, '%')
            </if>
            <if test="dataType!=null and dataType!=''">
                and bms.data_type like concat('%', #{dataType}, '%')
            </if>
        </where>
    </sql>
    <sql id="select_monthly_gross_margin">
        <where>
            1=1
            <if test="beginCreateTime!=null and beginCreateTime!=''">
                and bmgm.month between #{beginCreateTime}
            </if>
            <if test="createTime!=null and createTime!=''">
                and #{createTime}
            </if>
            <if test="productSortCode!=null and productSortCode!=''">
                and bmgm.product_sort_code like concat('%', #{productSortCode}, '%')
            </if>
            <if test="productSortName!=null and productSortName!=''">
                and bmgm.product_sort_name like concat('%', #{productSortName}, '%')
            </if>
            <if test="orderCode!=null and orderCode!=''">
                and bmgm.price_channel_code like concat('%', #{orderCode}, '%')
            </if>
            <if test="orderOriginal!=null and orderOriginal!=''">
                and bmgm.price_channel_name like concat('%', #{orderOriginal}, '%')
            </if>
            <if test="storeTypeCode!=null and storeTypeCode!=''">
                and bmgm.store_type_code like concat('%', #{storeTypeCode}, '%')
            </if>
            <if test="storeType!=null and storeType!=''">
                and bmgm.store_type like concat('%', #{storeType}, '%')
            </if>
            <if test="dataTypeCode!=null and dataTypeCode!=''">
                and bmgm.data_type_code like concat('%', #{dataTypeCode}, '%')
            </if>
            <if test="dataType!=null and dataType!=''">
                and bmgm.data_type like concat('%', #{dataType}, '%')
            </if>

        </where>
    </sql>
    <sql id="select_month_sales_achievement">
        <where>
            1=1
            <if test="beginCreateTime!=null and beginCreateTime!=''">
                and bmsa.month between #{beginCreateTime}
            </if>
            <if test="createTime!=null and createTime!=''">
                and #{createTime}
            </if>
            <if test="productSortCode!=null and productSortCode!=''">
                and bmsa.product_sort_code like concat('%', #{productSortCode}, '%')
            </if>
            <if test="productSortName!=null and productSortName!=''">
                and bmsa.product_sort_name like concat('%', #{productSortName}, '%')
            </if>
            <if test="orderCode!=null and orderCode!=''">
                and bmsa.price_channel_code like concat('%', #{orderCode}, '%')
            </if>
            <if test="orderOriginal!=null and orderOriginal!=''">
                and bmsa.price_channel_name like concat('%', #{orderOriginal}, '%')
            </if>
            <if test="storeTypeCode!=null and storeTypeCode!=''">
                and bmsa.store_type_code like concat('%', #{storeTypeCode}, '%')
            </if>
            <if test="storeType!=null and storeType!=''">
                and bmsa.store_type like concat('%', #{storeType}, '%')
            </if>
            <if test="dataTypeCode!=null and dataTypeCode!=''">
                and bmsa.data_type_code like concat('%', #{dataTypeCode}, '%')
            </if>
            <if test="dataType!=null and dataType!=''">
                and bmsa.data_type like concat('%', #{dataType}, '%')
            </if>

        </where>
    </sql>
    <sql id="select_month_cumulative_brand_sales">
        <where>
            1=1
            <if test="beginCreateTime!=null and beginCreateTime!=''">
                and bmcbs.month between #{beginCreateTime}
            </if>
            <if test="createTime!=null and createTime!=''">
                and #{createTime}
            </if>
            <if test="productSortCode!=null and productSortCode!=''">
                and bmcbs.product_sort_code like concat('%', #{productSortCode}, '%')
            </if>
            <if test="productSortName!=null and productSortName!=''">
                and bmcbs.product_sort_name like concat('%', #{productSortName}, '%')
            </if>
            <if test="orderCode!=null and orderCode!=''">
                and bmcbs.price_channel_code like concat('%', #{orderCode}, '%')
            </if>
            <if test="orderOriginal!=null and orderOriginal!=''">
                and bmcbs.price_channel_name like concat('%', #{orderOriginal}, '%')
            </if>
            <if test="storeTypeCode!=null and storeTypeCode!=''">
                and bmcbs.store_type_code like concat('%', #{storeTypeCode}, '%')
            </if>
            <if test="storeType!=null and storeType!=''">
                and bmcbs.store_type like concat('%', #{storeType}, '%')
            </if>
            <if test="dataTypeCode!=null and dataTypeCode!=''">
                and bmcbs.data_type_code like concat('%', #{dataTypeCode}, '%')
            </if>
            <if test="dataType!=null and dataType!=''">
                and bmcbs.data_type like concat('%', #{dataType}, '%')
            </if>

        </where>
    </sql>
    <sql id="select_month_cumulative_gross_profit_margin">
        <where>
            1=1
            <if test="beginCreateTime!=null and beginCreateTime!=''">
                and bmcgpm.month between #{beginCreateTime}
            </if>
            <if test="createTime!=null and createTime!=''">
                and #{createTime}
            </if>
            <if test="productSortCode!=null and productSortCode!=''">
                and bmcgpm.product_sort_code like concat('%', #{productSortCode}, '%')
            </if>
            <if test="productSortName!=null and productSortName!=''">
                and bmcgpm.product_sort_name like concat('%', #{productSortName}, '%')
            </if>
            <if test="orderCode!=null and orderCode!=''">
                and bmcgpm.price_channel_code like concat('%', #{orderCode}, '%')
            </if>
            <if test="orderOriginal!=null and orderOriginal!=''">
                and bmcgpm.price_channel_name like concat('%', #{orderOriginal}, '%')
            </if>
            <if test="storeTypeCode!=null and storeTypeCode!=''">
                and bmcgpm.store_type_code like concat('%', #{storeTypeCode}, '%')
            </if>
            <if test="storeType!=null and storeType!=''">
                and bmcgpm.store_type like concat('%', #{storeType}, '%')
            </if>
            <if test="dataTypeCode!=null and dataTypeCode!=''">
                and bmcgpm.data_type_code like concat('%', #{dataTypeCode}, '%')
            </if>
            <if test="dataType!=null and dataType!=''">
                and bmcgpm.data_type like concat('%', #{dataType}, '%')
            </if>

        </where>
    </sql>

    <select id="selectMonthlySales" parameterType="com.aiqin.bms.scmp.api.bireport.domain.request.ChartReqVo"
            resultType="com.aiqin.bms.scmp.api.bireport.domain.response.MonthlySalesRespVo">
        select
        bms.id as id,
        date_format(bms.create_time, '%Y-%m-%d %H:%i:%s') as createTime,
        bms.year_month as month,
        bms.product_sort_code as productSortCode,
        bms.product_sort_name as productSortName,
        bms.price_channel_code as orderCode,
        bms.price_channel_name as orderOriginal,
        bms.store_type_code as storeTypeCode,
        bms.store_type as storeType,
        bms.data_type_code as dataTypeCode,
        bms.data_type as dataType,
        bms.channel_order_amount as channelOrderAmount,
        bms.channel_last_year_sales as channelLastYearSales,
        bms.channel_last_month_sales as channelLastMonthSales,
        bms.channel_compared_same as channelComparedSame,
        bms.channel_sequential as channelSequential,
        bms.distribution_order_amount as distributionOrderAmount,
        bms.distribution_last_year_sales as distributionLastYearSales,
        bms.distribution_last_month_sales as distributionLastMonthSales,
        bms.distribution_compared_same as distributionComparedSame,
        bms.distribution_sequential as distributionSequential
        from bi_monthly_sales bms
        <include refid="select_monthly_sales"/>
        order by bms.id asc
    </select>
    <select id="selectMonthlyGrossMargin" parameterType="com.aiqin.bms.scmp.api.bireport.domain.request.ChartReqVo"
            resultType="com.aiqin.bms.scmp.api.bireport.domain.response.MonthlyGrossMarginRespVo">
        select
        bmgm.id as id,
        date_format(bmgm.create_time, '%Y-%m-%d %H:%i:%s') as createTime,
        bmgm.month as month,
        bmgm.product_sort_code as productSortCode,
        bmgm.product_sort_name as productSortName,
        bmgm.price_channel_code as orderCode,
        bmgm.price_channel_name as orderOriginal,
        bmgm.store_type_code as storeTypeCode,
        bmgm.store_type as storeType,
        bmgm.data_type_code as dataTypeCode,
        bmgm.data_type as dataType,
        bmgm.sales_cost as salesCost,
        bmgm.channel_amount as channelAmount,
        bmgm.channel_maori as channelMaori,
        bmgm.channel_maori_rate as channelMaoriRate,
        bmgm.channel_last_year_maori_rate as channelLastYearMaoriRate,
        bmgm.channel_compared_same as channelComparedSame,
        bmgm.channel_sequential as channelSequential,
        bmgm.distribution_amount as distributionAmount,
        bmgm.distribution_maori as distributionMaori,
        bmgm.distribution_maori_rate as distributionMaoriRate,
        bmgm.distribution_last_year_maori_rate as distributionLastYearMaoriRate,
        bmgm.distribution_compared_same as distributionComparedSame,
        bmgm.distribution_sequential as distributionSequential
        from bi_month_gross_margin bmgm
        <include refid="select_monthly_gross_margin"/>
        order by bmgm.id asc
    </select>
    <select id="selectMonthSalesAchievement" parameterType="com.aiqin.bms.scmp.api.bireport.domain.request.ChartReqVo"
            resultType="com.aiqin.bms.scmp.api.bireport.domain.response.MonthSalesAchievementRespVo">
        select
        bmsa.id as id,
        date_format(bmsa.create_time, '%Y-%m-%d %H:%i:%s') as createTime,
        bmsa.month as month,
        bmsa.product_sort_code as productSortCode,
        bmsa.product_sort_name as productSortName,
        bmsa.price_channel_code as orderCode,
        bmsa.price_channel_name as orderOriginal,
        bmsa.store_type_code as storeTypeCode,
        bmsa.store_type as storeType,
        bmsa.data_type_code as dataTypeCode,
        bmsa.data_type as dataType,
        bmsa.category_code as categoryCode,
        bmsa.category_name as categoryName,
        bmsa.channel_amount as channelAmount,
        bmsa.channel_budget as channelBudget,
        bmsa.channel_yield_rate as channelYieldRate,
        bmsa.distribution_amount as distributionAmount,
        bmsa.distribution_budget as distributionBudget,
        bmsa.distribution_yield_rate as distributionYieldRate
        from bi_month_sales_achievement bmsa
        <include refid="select_month_sales_achievement"/>
        order by bmsa.id asc
    </select>
    <select id="sumMonthSalesAchievement" resultType="com.aiqin.bms.scmp.api.bireport.domain.response.MonthSalesAchievementRespVo">
        SELECT
        bmsa.id as id,
        SUM(bmsa.channel_amount) as channelAmount,
        SUM(bmsa.channel_budget) as channelBudget,
        SUM(bmsa.channel_amount)/SUM(bmsa.channel_budget) as channelYieldRate,
        SUM(bmsa.distribution_amount) as distributionAmount,
        SUM(bmsa.distribution_budget) as distributionBudget,
        SUM(bmsa.distribution_amount)/SUM(bmsa.distribution_budget) as distributionYieldRate
        from bi_month_sales_achievement bmsa
        <include refid="select_month_sales_achievement"/>
        order by bmsa.id asc
    </select>
    <select id="selectMonthCumulativeBrandSales" parameterType="com.aiqin.bms.scmp.api.bireport.domain.request.ChartReqVo"
            resultType="com.aiqin.bms.scmp.api.bireport.domain.response.MonthCumulativeBrandSalesRespVo">
        select
        bmcbs.id as id,
        date_format(bmcbs.create_time, '%Y-%m-%d %H:%i:%s') as createTime,
        bmcbs.month as month,
        bmcbs.product_sort_code as productSortCode,
        bmcbs.product_sort_name as productSortName,
        bmcbs.price_channel_code as orderCode,
        bmcbs.price_channel_name as orderOriginal,
        bmcbs.store_type_code as storeTypeCode,
        bmcbs.store_type as storeType,
        bmcbs.data_type_code as dataTypeCode,
        bmcbs.data_type as dataType,
        bmcbs.category_code as categoryCode,
        bmcbs.category_name as categoryName,
        bmcbs.channel_sales as channelSales,
        bmcbs.channel_last_year_sales as channelLastYearSales,
        bmcbs.channel_last_month_sales as channelLastMonthSales,
        bmcbs.channel_compared_same as channelComparedSame,
        bmcbs.channel_sequential as channelSequential,
        bmcbs.distribution_sales as distributionSales,
        bmcbs.distribution_last_year_sales as distributionLastYearSales,
        bmcbs.distribution_last_month_sales as distributionLastMonthSales,
        bmcbs.distribution_compared_same as distributionComparedSame,
        bmcbs.distribution_sequential as distributionSequential
        from bi_month_cumulative_brand_sales bmcbs
        <include refid="select_month_cumulative_brand_sales"/>
        order by bmcbs.id asc
    </select>
    <select id="selectMonthCumulativeGrossProfitMargin" parameterType="com.aiqin.bms.scmp.api.bireport.domain.request.ChartReqVo"
            resultType="com.aiqin.bms.scmp.api.bireport.domain.response.MonthCumulativeGrossProfitMarginRespVo">
        select
        bmcgpm.id as id,
        date_format(bmcgpm.create_time, '%Y-%m-%d %H:%i:%s') as createTime,
        bmcgpm.month as month,
        bmcgpm.cumulative_month as cumulativeMonth,
        bmcgpm.product_sort_code as productSortCode,
        bmcgpm.product_sort_name as productSortName,
        bmcgpm.price_channel_code as orderCode,
        bmcgpm.price_channel_name as orderOriginal,
        bmcgpm.store_type_code as storeTypeCode,
        bmcgpm.store_type as storeType,
        bmcgpm.data_type_code as dataTypeCode,
        bmcgpm.data_type as dataType,
        bmcgpm.category_code as categoryCode,
        bmcgpm.category_name as categoryName,
        bmcgpm.sales_cost as salesCost,
        bmcgpm.channel_amount as channelAmount,
        bmcgpm.channel_maori as channelMaori,
        bmcgpm.channel_maori_rate as channelMaoriRate,
        bmcgpm.channel_last_maori_rate as channelLastMaoriRate,
        bmcgpm.last_year_channel_maori_rate as lastYearChannelMaoriRate,
        bmcgpm.channel_compared_same as channelComparedSame,
        bmcgpm.channel_sequential as channelSequential,
        bmcgpm.distribution_amount as distributionAmount,
        bmcgpm.distribution_maori as distributionMaori,
        bmcgpm.distribution_maori_rate as distributionMaoriRate,
        bmcgpm.distribution_last_maori_rate as distributionLastMaoriRate,
        bmcgpm.last_year_distribution_maori_rate as lastYearDistributionMaoriRate,
        bmcgpm.distribution_compared_same as distributionComparedSame,
        bmcgpm.distribution_sequential as distributionSequential
        from bi_month_cumulative_gross_profit_margin bmcgpm
        <include refid="select_month_cumulative_gross_profit_margin"/>
        order by bmcgpm.id asc
    </select>
</mapper>
