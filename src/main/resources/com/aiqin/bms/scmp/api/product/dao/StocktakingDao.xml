<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aiqin.bms.scmp.api.product.dao.StocktakingDao">
    <resultMap id="BaseResultMap" type="com.aiqin.bms.scmp.api.product.domain.Stocktaking.StocktakingInfo">
        <result column="stocktaking_id" jdbcType="VARCHAR" property="stocktakingId"/>
        <result column="stocktaking_code" jdbcType="VARCHAR" property="stocktakingCode"/>
        <result column="store_id" jdbcType="VARCHAR" property="storeId"/>
        <result column="store_name" jdbcType="VARCHAR" property="storeName"/>
        <result column="storage_type" jdbcType="TINYINT" property="storageType"/>
        <result column="stock_type" jdbcType="TINYINT" property="stockType"/>
        <result column="stocktaking_status" jdbcType="TINYINT" property="stocktakingStatus"/>
        <result column="stocktaking_date" jdbcType="VARCHAR" property="stocktakingDate"/>
        <result column="create_by" jdbcType="VARCHAR" property="createBy"/>
        <result column="update_by" jdbcType="VARCHAR" property="updateBy"/>
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="update_time" jdbcType="TIMESTAMP" property="updateTime"/>
        <result column="memo" jdbcType="VARCHAR" property="memo"/>
    </resultMap>
    <resultMap id="ProductResultMap" type="com.aiqin.bms.scmp.api.product.domain.Stocktaking.StocktakingProductInfo">
        <result column="Stocktaking_product_id" jdbcType="VARCHAR" property="StocktakingProductId"/>
        <result column="stocktaking_id" jdbcType="VARCHAR" property="stocktakingId"/>
        <result column="sku_code" jdbcType="VARCHAR" property="skuCode"/>
        <result column="spu_code" jdbcType="VARCHAR" property="spuCode"/>
        <!-- <result column="distributor_id" jdbcType="VARCHAR" property="distributorId"/>
        <result column="distributor_code" jdbcType="VARCHAR" property="distributorCode"/>
        <result column="distributor_name" jdbcType="VARCHAR" property="distributorName"/> -->
        <result column="bar_code" jdbcType="VARCHAR" property="barCode"/>
        <result column="product_id" jdbcType="VARCHAR" property="productId"/>
        <result column="product_code" jdbcType="VARCHAR" property="productCode"/>
        <result column="product_name" jdbcType="VARCHAR" property="productName"/>
        <result column="category_id" jdbcType="VARCHAR" property="categoryId"/>
        <result column="category_name" jdbcType="VARCHAR" property="categoryName"/>
        <result column="spec" jdbcType="VARCHAR" property="spec"/>
        <result column="unit" jdbcType="VARCHAR" property="unit"/>
        <result column="unit_code" jdbcType="VARCHAR" property="unitCode"/>
        <result column="color_code" jdbcType="VARCHAR" property="colorCode"/>
        <result column="color_name" jdbcType="VARCHAR" property="colorName"/>
        <result column="model_number" jdbcType="VARCHAR" property="modelNumber"/>
        <result column="show_name" jdbcType="VARCHAR" property="showName"/>
        <result column="logo" jdbcType="VARCHAR" property="logo"/>
        <result column="images" jdbcType="VARCHAR" property="images"/>
        <result column="total_stock" jdbcType="BIGINT" property="totalStock"/>
        <result column="real_stock" jdbcType="BIGINT" property="realStock"/>
        <result column="differ_amount" jdbcType="BIGINT" property="differAmount"/>
        <result column="differ_status" jdbcType="TINYINT" property="differStatus"/>
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="update_time" jdbcType="TIMESTAMP" property="updateTime"/>
        <result column="create_by" jdbcType="VARCHAR" property="createBy"/>
        <result column="update_by" jdbcType="VARCHAR" property="updateBy"/>
        <result column="del_flag" jdbcType="TINYINT" property="delFlag" />
    </resultMap>
    
        <insert id="addStocktakingInfo" parameterType="com.aiqin.bms.scmp.api.product.domain.Stocktaking.StocktakingInfo">
        INSERT  INTO stocktaking_info (
        stocktaking_id,    
        store_id,          
        store_name,        
        stocktaking_code,
        <if test="storageType!=null">
        storage_type,
        </if>
        <if test="stockType!=null">
        stock_type, 
        </if>
        <if test="stocktakingStatus!=null">
        stocktaking_status,
        </if>
        stocktaking_date,  
        create_by,         
        update_by,         
        create_time,      
        update_time,
        memo     
        )
 values
        (
        #{stocktakingId},
        #{storeId},
        #{storeName},
        #{stocktakingCode},
        <if test="storageType!=null">
        #{storageType},
        </if>
        <if test="stockType!=null">
        #{stockType},
        </if>
        <if test="stocktakingStatus!=null">
        #{stocktakingStatus},
        </if>
        #{stocktakingDate},
        #{createBy},
        #{updateBy},
        CURRENT_TIMESTAMP,
        #{updateTime},
        #{memo}
        )
    </insert>
    
    <insert id="addProductInfo" parameterType="com.aiqin.bms.scmp.api.product.domain.Stocktaking.StocktakingProductInfo">
        INSERT  INTO stocktaking_product_info (
             Stocktaking_product_id,             
             stocktaking_id,                                       
             sku_code,                                                      
             spu_code,                                                                                                                                                                          
             bar_code,                                                      
             product_id,                                                    
             product_code,                                         
             product_name,                                         
             category_id,                                          
             category_name,                                        
             spec,                                                                   
             unit,                                                                   
             color_code,                                                    
             color_name,                                                    
             unit_code,                                                     
             model_number,                                         
             show_name,                                                     
             logo,                                                                   
             images,
             <if test=" totalStock !=null ">
             total_stock, 
             </if>
             <if test="realStock !=null ">                                                                                             
             real_stock,
             </if>
             <if test="differAmount !=null ">                                                   
             differ_amount,
             </if>  
             <if test="differStatus !=null ">                                                   
             differ_status,
             </if>                                                                             
             create_time,                                          
             update_time,                                          
             create_by,                                                     
             update_by  
        )
 values
        (
             #{StocktakingProductId},
             #{stocktakingId},
             #{skuCode},
             #{spuCode},
             #{barCode},
             #{productId},
             #{productCode},
             #{productName},
             #{categoryId},
             #{categoryName},
             #{spec},
             #{unit},
             #{colorCode},
             #{colorName},
             #{unitCode},
             #{modelNumber},
             #{showName},
             #{logo},
             #{images},
             <if test=" totalStock !=null ">
             #{totalStock},
             </if> 
             <if test="realStock !=null "> 
             #{realStock},
             </if> 
             <if test="differAmount !=null "> 
             #{differAmount},
             </if>
             <if test="differStatus !=null ">                                                   
             #{differStatus},
             </if> 
             CURRENT_TIMESTAMP,
             #{updateTime},
             #{createBy},
             #{updateBy}
        )
    </insert>
    
    <!--接口-查询盘点记录信息列表-->
    <select id="selectStocktakingList" resultMap ="BaseResultMap" resultType="java.util.List">
         select stocktaking_id,stocktaking_code,storage_type,stock_type,stocktaking_status,stocktaking_date,create_time,create_by,memo from stocktaking_info where 1=1
         <if test="storeId !=null and storeId !='' ">
         and store_id = #{storeId}
         </if>
         <if test="storageType !=null ">
         and storage_type = #{storageType}
         </if>
         <if test="stockType !=null ">
         and stock_type = #{stockType}
         </if>
         <if test="stocktakingDate !=null and stocktakingDate !='' ">
         and stocktaking_date = #{stocktakingDate}
         </if>
         <if test="memo !=null and memo !='' ">
         and memo like concat('%',#{memo,jdbcType=VARCHAR},'%') 
         </if>
         limit #{beginIndex,jdbcType=INTEGER}, #{pageSize,jdbcType=INTEGER}
    </select>
    
    <!--接口-查询盘点记录信息实体类-->
    <select id="selectStocktaking" resultMap ="BaseResultMap" >
         select stocktaking_id,stocktaking_code,storage_type,stock_type,stocktaking_status,stocktaking_date,create_time,create_by,memo from stocktaking_info where 1=1
         <if test="stocktakingId !=null and stocktakingId !='' ">
         and stocktaking_id = #{stocktakingId}
         </if>
         <if test="storageType !=null ">
         and storage_type = #{storageType}
         </if>
         <if test="stockType !=null ">
         and stock_type = #{stockType}
         </if>
         <if test="stocktakingDate !=null and stocktakingDate !='' ">
         and stocktaking_date = #{stocktakingDate}
         </if>
         <if test="memo !=null and memo !='' ">
         and memo like concat('%',#{memo,jdbcType=VARCHAR},'%') 
         </if>
         limit 1
    </select>
    
    <!--接口-查询盘点记录信息总数据条数-->
    <select id="countStocktaking" resultType="java.lang.Integer">
         select count(1) from stocktaking_info where 1=1
         <if test="storeId !=null and storeId !='' ">
         and store_id = #{storeId}
         </if>
         <if test="storageType !=null ">
         and storage_type = #{storageType}
         </if>
         <if test="stockType !=null ">
         and stock_type = #{stockType}
         </if>
         <if test="stocktakingDate !=null and stocktakingDate !='' ">
         and stocktaking_date = #{stocktakingDate}
         </if>
    </select>
    
    <!--查询商品信息列表分页-->
    <select id="selectProductList" resultMap ="ProductResultMap" resultType="java.util.List">
         select product_code, product_name,spec,unit_code,color_code,color_name,unit,unit_code,
                model_number,show_name,logo,images,total_stock,real_stock,differ_amount,differ_status       
         from stocktaking_product_info where 1=1
         <if test="stocktakingId !=null and stocktakingId !='' ">
         and stocktaking_id = #{stocktakingId}
         </if>
         <if test="stocktakingIdList != null" >
		     and stocktaking_id in (
		  <foreach collection="stocktakingIdList" item="stocktaking_id" separator=",">
			 '${stocktaking_id}'
		  </foreach>
			)
          </if>
         <if test="barCode !=null and barCode !='' ">
         and bar_code = #{barCode}
         </if>
         <if test="productId !=null and productId !='' ">
         and product_id = #{productId}
         </if>
         <if test="skuCode !=null and skuCode !='' ">
         and sku_code = #{skuCode}
         </if>
         and del_flag is null
         limit #{beginIndex,jdbcType=INTEGER}, #{pageSize,jdbcType=INTEGER}
    </select>
    <!--查询商品信息列表总数据条数-->
    <select id="countProductList" resultType="java.lang.Integer">
         select count(1)      
         from stocktaking_product_info where 1=1
         <if test="stocktakingId !=null and stocktakingId !='' ">
         and stocktaking_id = #{stocktakingId}
         </if>
         <if test="stocktakingIdList != null" >
		     and stocktaking_id in (
		  <foreach collection="stocktakingIdList" item="stocktaking_id" separator=",">
			 '${stocktaking_id}'
		  </foreach>
			)
          </if>
          <if test="barCode !=null and barCode !='' ">
         and bar_code = #{barCode}
         </if>
         <if test="productId !=null and productId !='' ">
         and product_id = #{productId}
         </if>
         <if test="skuCode !=null and skuCode !='' ">
         and sku_code = #{skuCode}
         </if>
         and del_flag is null
    </select>
    
    <!--更新商品信息删除标识-->
    <update id="updateDelFlag">
         update stocktaking_product_info set del_flag = 1 where 1=1
         <if test="stocktakingProductId !=null and stocktakingProductId !='' ">
         and stocktaking_product_id = #{stocktakingProductId}
         </if>
    </update>
</mapper>
